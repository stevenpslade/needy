<div class="container">
<div class="row">
  <!-- if TASK.NEEDED_ID is not present, then continue displaying the number of request and who has requested the task -->
  <% if @task.needed_id == nil %>
    <div class="top-content col s4">
      <img class="task-user-image" src="<%= @task.image_url %>"/>
      <p>Needy user: <%= User.find(@task.user_id).full_name %></p>
    </div>
    <div class=" top-content col s4">
      <div><%= render 'map/tasks/map' %></div>
    </div>
    <div class="top-content col s4">
      <% all_requests = Request.where(task_id: @task.id) %>
      <p>There are currently <%= all_requests.count %> users requesting to do this job! Click to view their profile.</p>
      <p>
        <small>| 
          <% all_requests.each do |request| %>
            <% requester = User.find(request.user_id) %>
            <%= link_to requester.full_name, user_path(request.user_id) %> | 
          <% end %>
        </small>
      </p>
      <% if current_user.id == @task.user_id %>
        <p>Select one of the Needed's below and approve their request!</p>
        <!-- APPROVAL STUFF SHOULD GO HERE --> 
        <%= form_for @task do |f|%>
          <% all_requests.each do |r| %>
            <p>
              <input name="needed_id" type="radio" id="<%= r[:user_id] %>" value="<%= r[:user_id] %>"  /> 
              <label for="<%= r[:user_id] %>"><%= User.find(r[:user_id]).full_name %></label>
            </p>
          <% end %>
            <%= f.submit("Approve Request", name: nil) %>
        <% end %>
      <% end %>
    </div>
  <% else %>
    <!-- if the CURRENT USER is the user who POSTED the TASK -->
    <% if current_user.id == @task.user_id %>
      <div class="top-content col s6">
        <img class="task-user-image" src="<%= @task.image_url %>"/>
        <p>Needy user:  ME!!!!</p>
        <p>Needed user: <%= User.find(@task.needed_id).full_name %></p>
      </div>
    <!-- if the CURRENT USER is the user who  ACCEPTED to do the TASK -->
    <% elsif current_user.id == @task.needed_id %>
       <div class="top-content col s6">
        <img class="task-user-image" src="<%= @task.image_url %>"/>
        <p>Needy user: <%= User.find(@task.user_id).full_name %></p>
        <p>Needed user: MEE!!!</p>
      </div>
      <!-- if CURRENT USER is not assocaited with the task -->
    <% elsif current_user.id != @task.user_id && current_user.id != @task.needed_id %>
      <div class="top-content col s6">
        <img class="task-user-image" src="<%= @task.image_url %>"/>
        <p>Needy user:  <%= User.find(@task.user_id).full_name %></p>
        <p>Needed user: <%= User.find(@task.needed_id).full_name %></p>
      </div>
    <% end %>
  <% end %>
</div>
<div class="row task-icons">
  <div class="col s12">
    <div class="card blue-grey darken-1">
        <div class="col s4">
          <i class="material-icons large">tune</i>
          <p><%= @task.difficulty %></p>
        </div>
        <div class="col s4">
          <i class="material-icons large">access_alarms</i>
          <p><%= @task.estimated_duration %> min</p>
        </div>
        <div class="col s4">
          <i class="material-icons large">adb</i>
          <p>$<%= @task.compensation %></p>
        </div>
      <div class="card-action">
        <a id="start">Start Task</a>
      </div>
    </div>
  </div>
</div>
<!--   <div class="row task-timer">
=======

<div class="row task-timer">
>>>>>>> 1d48cf9ac99f6b131084fa699ee83d0b783304ae
  <div class="col s12">
    <div class="card blue-grey darken-1">
        <span id="time">00:00:00</span>
      <div class="card-action">
        <button id="start">Start</button>
        <button id ="stop">Pause</button>
        <button id="reset">End</button>
      </div>
    </div>
  </div>
<<<<<<< HEAD
</div> -->
<div class="row">
  <div class="col s6">
    <h5 class="center-align"><%= @task.description %></h5>
  </div>
</div>
<!-- if CURRENT USER is not the POSTER of the TASK, BUT was the NEEDED USER -->
<% if (current_user.id != @task.user_id) && (@task.needed_id == current_user.id)  %>
  <div class="row">
    <div class="col s6 hidden-element"><h1></h1></div>
      <form class="col s6 center-align">
        <div class="need-me-btn input-field col s8">
          <%= form_for @review do |f| %>
            <i class="material-icons prefix">mode_edit</i>
            <textarea id="comment" class="materialize-textarea"></textarea>
            <%= f.hidden_field :user_id,:value=> current_user.id %>
            <%= f.hidden_field :task_id,:value=> @task.id %>
            <%= f.hidden_field :for_user,:value=> @task.user_id %>
            <button class="btn waves-effect waves-light" type="submit" name="action">
            <%= f.submit %>for <%= User.find(@task.user_id).first_name %>
            </button>
          <% end %>
        </div>
      </form>
  </div>      
<!-- if CURRENT USER is the POSTER of the TASK, and NEEDED_ID is PRESENT -->
<% elsif (current_user.id == @task.user_id) && (@task.needed_id != nil)  %>
  <div class="row hidden-element">
    <div class="col s6 hidden-element"><h1></h1></div>
      <div class="col s6 center-align">
        <div class="need-me-btn">
          <%= form_for @review do |f| %>
            <%= f.hidden_field :user_id,:value=> current_user.id %>
            <%= f.hidden_field :task_id,:value=> @task.id %>
            <%= f.hidden_field :for_user,:value=> @task.needed_id %>
            <button class="btn waves-effect waves-light change-value-text" type="submit" name="action">
            <%= f.submit %>for <%= User.find(@task.needed_id).first_name %>
            </button>
          <% end %>
        </div>
      </div>
  </div>
<!-- if CURRENT USER is not the POSTER of the TASK, and NO NEEDED_ID -->
<% elsif (current_user.id != @task.user_id) && @task.needed_id == nil %>
  <div class="row">
    <div class="col s6 hidden-element"><h1></h1></div>
      <div class="col s6 center-align">
        <div class="need-me-btn">
          <%= form_for @request do |f| %>
            <%= f.hidden_field :user_id,:value=> current_user.id %>
            <%= f.hidden_field :task_id,:value=> @task.id %>
            <button class="btn waves-effect waves-light" type="submit" name="action">
            <%= f.submit %>
            </button>
          <% end %>
        </div>
      </div>
  </div>      
<% end %>
</div>